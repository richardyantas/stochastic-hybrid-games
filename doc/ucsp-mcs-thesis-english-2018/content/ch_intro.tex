    \chapter{Introduction}
    
    \label{ch:intro}
    In this thesis, we present a control synthesis method for a special 
    form of hybrid systems with stochastic perturbations that we model as
    a \ac{SHG}. Such models have been 
    recently used in various domains such as solar energy industry and power 
    electronics (e.g power converters). They are continuous-time systems
    with discrete switching events. More precisely, these systems are 
    described by piecewise continuous dynamics called \emph{modes}; the 
    change of modes takes place instantaneously at so-called \emph{switching
    instants}. We suppose that switching instants occur \emph{periodically}
    at constant sampling period $\tau$ \emph{sampled switching systems}.
    The \emph{control synthesis} problem consist in finding a \emph{switching}
    rule $\sigma$ in order to satisfy a given specification. At each sampling
    time $\tau, 2\tau,..,$ according to the state of the system, the rule 
    $\sigma$ selects an appropiate mode to fulfill the specification.
    \ac{SHG} has challenging problems such as optimization and safety that
    are some of those which hybrid system community are focused. For this reason,
    we implement a methodology to improve a real time \ac{SHG} that combines
    model checking, reinforcement learning and constraint computation. We 
    use formal methods to synthetize a safe and near optimal controller. 
    In \autoref{sec:casestudy}, we model a \ac{SWH}, including 
    the human interaction to access the water 
    in it as stochastic. In \autoref{sec:uppaalstratego}, we define 
    use the tool \textsc{Uppaal Stratego} to synthetize
    a control strategy minimizing a cost function composed by energy consumption
    (\emph{optimization}) and temperature distance (\emph{safety}) while the last
    one also guaranteeing no overflow a max and min temparature defined previously.
    In \autoref{sec:onlinestochastichybridcontroller}, We define a \ac{SHG}
    
    % In \autoref{sec:motivation} we describe the motivation and 
    % context of our work, \autoref{sec:problem} presents our 
    % problem statement. \autoref{sec:objectives} shows the 
    % objectives of this work. Finally, \autoref{sec:contributions}
    % describes the structure of this thesis document.

    \section{Motivation and Context}
    \label{sec:motivation}
    %%%TODO: FALTA MAS TEXTO EN LA MOTIVATION

    Stochastic Hybrid systems are widely used in engineering 
    applications and its importance has grown up considerably 
    these last years, because of their ease of implementation 
    for controlling cyber-physical systems. A \ac{SHG} is a Stochastic 
    hybrid model which represent a set of dynamical systems supervised by 
    a switching rule $\sigma$, whose values are in a finite set 
    $\mathbb{C}$(See ~\cite{liberzon2003switching}) and a stochastic
    perturbation $u$, which together and also with the state variable $x$
    determine a configuraion $\gamma = (c,u,x)$ as defined in 
    \autoref{sec:onlinestochastichybridcontroller}. However, due to 
    the composition of many switched systems together with stochastic 
    perturbation, the global switched systems has ups and downs
    over each variables in the state without boundaries thus a risk
    in the system behaviour and the environment. For this reason,
    in order to guarantee to synthesize a safe and optimal strategy
    in each control step followed by a safe and near optimal control
    a long the real time system behaviour. \ac{SHG} have numerous applications 
    in control of mechanical systems, the automotive industry, and 
    many other fields. 
    
    \section{Problem Statement}
    \label{sec:problem}
    Nowadays, there is a large number of methods to face issues related 
    to switched systems; however in case of stochastic hybrid systems 
     we notice some advances either only optimization or only safety
     but none of them propose a method that concatenate these. 
    
    \section{Objectives}
    \label{sec:objectives}

        \subsection*{General Objective}
        Our main objective is to propose a methodology to synthesize switched 
        systems controller that guarantee safety and near optimal switching
        in real time. 

        \subsection*{Specific Objectives}
        To achieve our main objective, we have the following specific objectives:
        \begin{itemize}
            \item Define a case of study as a stochastic hybrid game and get its mathematical model.
            \item Implement and explore safe patterns for the model.
            \item Implement an \textsc{api} between the simulator and \textsc{uppaal} to Optimize the model.
            \item Compare results with traditional methods with our methodology.
        \end{itemize}


    \section{Contributions}
    \label{sec:contributions}
        The methodology builds on top of two existing works:      
        \begin{itemize}
            \item Find safe patterns for our case study using
            decomposition algorithm (\cite{le2017improved}).
                \begin{itemize}
                    \item The paper \cite{le2017improved} implements an algorithm to guarantee safe 
                    controller that is applied to our case study previously modelled.
                    \item Altough the algorithm allow to explore patterns(Sequence of operation modes) 
                    in our case due to system conditions was necessary to modify the 
                    algorithm doing it able to forbid some transitions between modes.                  
                \end{itemize}
            \item Find a near optimal patterns to online control(\cite{larsen2016online}).
            \begin{itemize}
                \item We use the online control method described in \cite{larsen2016online} to build our real time simulator, and also 
                the stochastic hybrid game model proposed in the paper is used in this thesis 
                to incorporate safe patterns as an input of \textsc{Uppaal Stratego}                
            \end{itemize}            
        \end{itemize}
        The implementation of an \textsc{api} between simulator and \textsc{uppaal stratego}, and 
        the representation of the model as timed automata \ac{MDP} in \textsc{uppaal} 
        for a real time \ac{MPC}, in order to verify the methodology, form 
        the main contribution in this work.            

    \section{Outline}
    %\label{sec:outline}
    This thesis document is divided into five chapters. After this 
    introduction and problem formulation, in \autoref{ch:relatedWorks}
     we survey the literature about the recent research in safety
      controllers and near optimal online controller synthesis. 
    \autoref{ch:background} presents some basic concepts about the
    hybrid systems, traditional controllers,
    stability criteria and optimal controller technique. Next, in
    \autoref{ch:proposal} we describe in detail the corpus, 
    techniques used by our pipeline and their evaluation results. 
    Finally, the limitations, future works, and conclusions of this work are 
    presented in \autoref{ch:conclusions}.











