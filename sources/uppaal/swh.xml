<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_2.dtd'>
<nta>
	<declaration>clock GTime;
//------------------------------- set Static values ------------------------------------------------------------

import "../../build/lib/libconfig.so" {
  int get_tau();
  double get_factorTe();
  double get_factorI();
  double get_factorKe();
  double get_rate_water_input(); // OK
  double get_TwaterIn();
  int    get_number_steps();
  double get_Tg();
  double get_alpha();
};

const int tau=get_tau();
const double factorTe=get_factorTe();
const double factorI=get_factorI();
const double factorKe=get_factorKe();
const double rateVo=get_rate_water_input();
const double TwaterIn=get_TwaterIn();
const double Tg=get_Tg();
const double alpha=get_alpha();

// ------------------------------------------------------------------------

const int nrSteps = get_number_steps(); //15  -- 6(work sometimes)
const int step    = tau; // 5 min
const int horizon = step*nrSteps; // 75 steps
const int horizon_tau = horizon + tau;


//---------------------------- set Dynamic variables ----------------------
import "../../build/lib/libconfig.so" {
  double get_T();
  double get_V();
  double get_E();
  int    get_time();
  int    get_valve();
  int    get_mode();
  void   get_Te(int h, double&amp; arr[horizon_tau]);
  void   get_Ti(int h, double&amp; arr[horizon_tau]);
  void   get_I(int h, double&amp; arr[horizon_tau]);
};

double T_ini, V_ini, E_ini;
double Te[horizon_tau], Ti[horizon_tau], I[horizon_tau];
int    mode_ini, valve_ini, t_ini;

void set_dynamic(){ 
    T_ini=get_T();
    V_ini=get_V();
    E_ini=get_E();
    t_ini=get_time();
    mode_ini= get_mode();
    valve_ini= get_valve();
    get_Te(horizon_tau,Te);
    get_Ti(horizon_tau,Ti);                // problem!!!
    get_I(horizon_tau,I);
}


// ------------------- Place global declarations here ----------------------
typedef double zonotope_t[4];
const int max_zonotopes = 64-1;
const int max_setListsPa= 64-1;
const int max_listPa    = 22-1;
const int max_paLen     = 3-1;
typedef int[0,max_zonotopes]  id_zonotope_t;
typedef int[0,max_setListsPa] id_list_patterns_t;
typedef int[0,max_listPa]     id_pattern_t;
typedef int[0,max_paLen]      pattern_len_t;   // 8
typedef int[0,max_zonotopes]  zid_t;

//id_list_patterns_t zonotope           = 0;
int zonotope;
//id_pattern_t       p_id               = 0;
int p_id;
double             x[3];//               = {0.0 , 0.0, 0.0};
int                pattern_size       = 0;
int                visitedPatterns    = 0;
int                ppos               = 0;
//int                mode               = 0;

// HERE ! mode initial
const int modes[8][3]    = {{ 1,0,0 },{ 1,1,0 },{ 2,0,0 },{ 2,1,0 },{ 3,0,1 },{ 3,1,1 },{ 2,0,1 },{ 2,1,1}};
typedef int dist_t[2][100];


const zonotope_t zonotopes[id_zonotope_t] = {
{40.0,40.4688,0.1,0.2},
{40.4688,40.9375,0.1,0.2},
{40.9375,41.4062,0.1,0.2},
{41.4062,41.875,0.1,0.2},
{41.875,42.3438,0.1,0.2},
{42.3438,42.8125,0.1,0.2},
{42.8125,43.2812,0.1,0.2},
{43.2812,43.75,0.1,0.2},
{43.75,44.2188,0.1,0.2},
{44.2188,44.6875,0.1,0.2},
{44.6875,45.1562,0.1,0.2},
{45.1562,45.625,0.1,0.2},
{45.625,46.0938,0.1,0.2},
{46.0938,46.5625,0.1,0.2},
{46.5625,47.0312,0.1,0.2},
{47.0312,47.5,0.1,0.2},
{47.5,47.9688,0.1,0.2},
{47.9688,48.4375,0.1,0.2},
{48.4375,48.9062,0.1,0.2},
{48.9062,49.375,0.1,0.2},
{49.375,49.8438,0.1,0.2},
{49.8438,50.3125,0.1,0.2},
{50.3125,50.7812,0.1,0.2},
{50.7812,51.25,0.1,0.2},
{51.25,51.7188,0.1,0.2},
{51.7188,52.1875,0.1,0.2},
{52.1875,52.6562,0.1,0.2},
{52.6562,53.125,0.1,0.2},
{53.125,53.5938,0.1,0.2},
{53.5938,54.0625,0.1,0.2},
{54.0625,54.5312,0.1,0.2},
{54.5312,55.0,0.1,0.2},
{55.0,55.4688,0.1,0.2},
{55.4688,55.9375,0.1,0.2},
{55.9375,56.4062,0.1,0.2},
{56.4062,56.875,0.1,0.2},
{56.875,57.3438,0.1,0.2},
{57.3438,57.8125,0.1,0.2},
{57.8125,58.2812,0.1,0.2},
{58.2812,58.75,0.1,0.2},
{58.75,59.2188,0.1,0.2},
{59.2188,59.6875,0.1,0.2},
{59.6875,60.1562,0.1,0.2},
{60.1562,60.625,0.1,0.2},
{60.625,61.0938,0.1,0.2},
{61.0938,61.5625,0.1,0.2},
{61.5625,62.0312,0.1,0.2},
{62.0312,62.5,0.1,0.2},
{62.5,62.9688,0.1,0.2},
{62.9688,63.4375,0.1,0.2},
{63.4375,63.9062,0.1,0.2},
{63.9062,64.375,0.1,0.2},
{64.375,64.8438,0.1,0.2},
{64.8438,65.3125,0.1,0.2},
{65.3125,65.7812,0.1,0.2},
{65.7812,66.25,0.1,0.2},
{66.25,66.7188,0.1,0.2},
{66.7188,67.1875,0.1,0.2},
{67.1875,67.6562,0.1,0.2},
{67.6562,68.125,0.1,0.2},
{68.125,68.5938,0.1,0.2},
{68.5938,69.0625,0.1,0.2},
{69.0625,69.5312,0.1,0.2},
{69.5312,70.0,0.1,0.2}
};


clock xc, yc, rc;
<<<<<<< HEAD
//double Tg = 55.0, pareto = 0.0;
double pareto = 0.0;
=======
double Tg = 55.0, pareto = 0.0;
>>>>>>> 41e7d3da9e19f511ef6e75f5618eab835fc102c7
double Tnext=0.0, Vnext=0.0, Enext=0.0;
int    it = 0, flag = 0;
id_zonotope_t zi   = 0;
int           patu = 0;

double paretoFunc()
{
//	double alpha=0.5;
	return pareto+( alpha*x[0] + (1.0-alpha)*fabs(Tg-x[2]) );
}

double dt_sec=60.0;
double E, V, T;
int mode, valve;
int j, index;

void post(int it, int mode_)
{
    int p,r,v,f;
    mode = mode_;
    p = modes[mode][0];
    r = modes[mode][1];
    f = modes[mode][2];
    v = valve; // v = 0
    index = it*tau;
    for(j=index; j &lt; index+tau; j=j+1)
    {
        E = x[0] + dt_sec*r*2;
        V = x[1] + dt_sec*rateVo*( 0.1*p - x[1] );
        T = x[2] + dt_sec*(1/(0.1*p))*(
                        - factorTe*2.8811059759131854e-06*(x[2]-Te[j])
                        - v*9.34673995175876e-05*(x[2]-Ti[j])
                        - f*factorKe*0.001005026*(0.1*p-x[1])*(x[2]-Ti[j])
                        + factorI*0.7*0.7*8.403225763080125e-07*I[j]
                        + r*0.008801843 ); // 0.00048018432931886426 - va[h]*9.34673995175876e-05*(x[0]-T_in[h])
        x[0]=E;
        x[1]=V;
        x[2]=T;
    }
    return;
}

void predict()
{
    set_dynamic();
    x[0] = E_ini;
    x[1] = V_ini;
    x[2] = T_ini;
    valve = valve_ini;
    post(0, mode_ini);
    //zi = getZonotope();
    //zi = getZono();
    //zi = tm;
    Tnext = T;
    return;
}


// zonotope_t = 128
const int allPatterns[id_list_patterns_t][id_pattern_t][pattern_len_t] = {
{{0,7,-1}, {1,6,-1}, {2,1,-1}, {4,1,-1}, {6,1,-1}, {0,1,6}, {0,4,1}, {0,6,1}, {2,0,1}, {3,0,7}, {3,3,0}, {3,5,0}, {3,7,0}, {4,0,1}, {5,0,7}, {5,3,0}, {5,5,0}, {6,0,1}, {7,0,7}, {7,3,0}, {7,5,0}, {7,7,0}},
{{0,7,-1}, {1,6,-1}, {2,1,-1}, {3,0,-1}, {4,1,-1}, {6,1,-1}, {0,1,6}, {0,4,1}, {0,6,1}, {2,0,1}, {4,0,1}, {5,0,7}, {5,3,0}, {5,5,0}, {6,0,1}, {7,0,7}, {7,3,0}, {7,5,0}, {7,7,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {1,6,-1}, {2,1,-1}, {3,0,-1}, {4,1,-1}, {6,1,-1}, {0,1,6}, {0,4,1}, {0,6,1}, {2,0,7}, {4,0,1}, {5,0,7}, {5,3,0}, {5,5,0}, {7,0,7}, {7,3,0}, {7,5,0}, {7,7,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {1,6,-1}, {2,1,-1}, {3,0,-1}, {4,1,-1}, {6,1,-1}, {0,1,6}, {0,4,1}, {0,6,1}, {1,4,0}, {2,0,7}, {4,0,1}, {5,0,7}, {5,3,0}, {5,5,0}, {6,0,7}, {7,0,7}, {7,3,0}, {7,5,0}, {7,7,0}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {1,6,-1}, {3,0,-1}, {4,1,-1}, {7,0,-1}, {0,1,6}, {0,4,1}, {0,6,3}, {1,4,0}, {2,0,7}, {2,1,6}, {2,4,1}, {4,0,7}, {5,0,7}, {5,3,0}, {5,5,0}, {6,0,7}, {6,1,6}, {6,4,1}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {1,6,-1}, {3,0,-1}, {4,1,-1}, {7,0,-1}, {0,1,6}, {0,6,3}, {1,4,0}, {2,0,7}, {2,1,6}, {4,0,7}, {5,0,7}, {5,3,0}, {5,5,0}, {6,0,7}, {6,1,6}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {1,6,-1}, {3,0,-1}, {7,0,-1}, {0,1,6}, {0,6,3}, {1,4,0}, {2,0,7}, {2,1,6}, {4,0,7}, {4,1,6}, {5,0,7}, {5,3,0}, {5,5,0}, {6,0,7}, {6,1,6}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {1,6,-1}, {3,0,-1}, {7,0,-1}, {0,1,6}, {0,6,3}, {1,4,0}, {2,0,7}, {2,1,6}, {4,0,7}, {4,1,6}, {5,0,7}, {5,3,0}, {5,5,0}, {6,0,7}, {6,1,6}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {1,6,-1}, {3,0,-1}, {7,0,-1}, {0,6,3}, {1,4,0}, {2,0,7}, {2,1,6}, {4,0,7}, {4,1,6}, {5,0,7}, {5,3,0}, {5,5,0}, {6,0,7}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {1,6,-1}, {3,0,-1}, {7,0,-1}, {0,6,3}, {1,4,0}, {2,0,7}, {4,0,7}, {4,1,6}, {5,0,7}, {5,3,0}, {5,5,0}, {6,0,7}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {3,0,-1}, {7,0,-1}, {0,6,3}, {2,0,7}, {4,0,7}, {5,0,7}, {5,3,0}, {5,5,0}, {6,0,7}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {3,0,-1}, {5,0,-1}, {7,0,-1}, {0,6,3}, {2,0,7}, {4,0,7}, {6,0,7}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {3,0,-1}, {5,0,-1}, {7,0,-1}, {0,6,3}, {2,0,7}, {2,3,0}, {4,0,7}, {4,3,0}, {6,0,7}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {3,0,-1}, {5,0,-1}, {7,0,-1}, {0,0,7}, {0,6,3}, {2,0,7}, {2,3,0}, {2,7,0}, {4,0,7}, {4,3,0}, {6,0,7}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {3,0,-1}, {5,0,-1}, {7,0,-1}, {0,0,7}, {0,6,3}, {2,0,7}, {2,3,0}, {2,7,0}, {4,0,7}, {4,3,0}, {6,0,7}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {3,0,-1}, {5,0,-1}, {7,0,-1}, {0,0,7}, {0,6,3}, {2,0,7}, {2,3,0}, {2,7,0}, {4,0,7}, {4,3,0}, {6,0,7}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {3,0,-1}, {5,0,-1}, {7,0,-1}, {0,0,7}, {0,6,3}, {2,0,7}, {2,3,0}, {2,7,0}, {4,0,7}, {4,3,0}, {6,0,7}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {3,0,-1}, {5,0,-1}, {7,0,-1}, {0,0,7}, {0,6,3}, {2,0,7}, {2,3,0}, {2,7,0}, {4,0,7}, {4,3,0}, {6,0,7}, {6,3,0}, {6,7,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {3,0,-1}, {5,0,-1}, {7,0,-1}, {0,0,7}, {0,6,3}, {2,0,7}, {2,3,0}, {2,7,0}, {4,0,7}, {4,3,0}, {6,0,7}, {6,3,0}, {6,7,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {3,0,-1}, {5,0,-1}, {7,0,-1}, {0,0,7}, {0,6,3}, {2,0,7}, {2,3,0}, {2,7,0}, {4,0,7}, {4,3,0}, {6,0,7}, {6,3,0}, {6,7,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {3,0,-1}, {5,0,-1}, {7,0,-1}, {0,0,7}, {0,6,3}, {2,0,7}, {2,3,0}, {2,7,0}, {4,0,7}, {4,3,0}, {4,5,0}, {6,0,7}, {6,3,0}, {6,7,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {3,0,-1}, {5,0,-1}, {7,0,-1}, {0,0,7}, {0,6,3}, {2,0,7}, {2,3,0}, {2,7,0}, {4,0,7}, {4,3,0}, {4,5,0}, {6,0,7}, {6,3,0}, {6,7,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {3,0,-1}, {5,0,-1}, {7,0,-1}, {0,0,7}, {0,6,3}, {2,0,7}, {2,3,0}, {2,5,0}, {2,7,0}, {4,0,7}, {4,3,0}, {4,5,0}, {6,0,7}, {6,3,0}, {6,7,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {3,0,-1}, {5,0,-1}, {7,0,-1}, {0,0,7}, {0,6,3}, {2,0,7}, {2,3,0}, {2,5,0}, {2,7,0}, {4,0,7}, {4,3,0}, {4,5,0}, {6,0,7}, {6,3,0}, {6,7,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {3,0,-1}, {5,0,-1}, {7,0,-1}, {0,0,7}, {0,6,3}, {2,0,7}, {2,3,0}, {2,5,0}, {2,7,0}, {4,0,7}, {4,3,0}, {4,5,0}, {6,0,7}, {6,3,0}, {6,7,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {3,0,-1}, {5,0,-1}, {7,0,-1}, {0,0,7}, {0,6,3}, {2,0,7}, {2,3,0}, {2,5,0}, {2,7,0}, {4,0,7}, {4,3,0}, {4,5,0}, {6,0,7}, {6,3,0}, {6,7,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {3,0,-1}, {5,0,-1}, {7,0,-1}, {0,0,7}, {0,6,3}, {2,0,7}, {2,3,0}, {2,5,0}, {2,7,0}, {4,0,7}, {4,3,0}, {4,5,0}, {6,0,7}, {6,3,0}, {6,5,0}, {6,7,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {3,0,-1}, {5,0,-1}, {7,0,-1}, {0,0,7}, {0,6,3}, {2,0,7}, {2,3,0}, {2,5,0}, {2,7,0}, {4,0,7}, {4,3,0}, {4,5,0}, {6,0,7}, {6,3,0}, {6,5,0}, {6,7,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {3,0,-1}, {5,0,-1}, {7,0,-1}, {0,0,7}, {0,6,3}, {2,0,7}, {2,3,0}, {2,5,0}, {2,7,0}, {4,0,7}, {4,3,0}, {4,5,0}, {6,0,7}, {6,3,0}, {6,5,0}, {6,7,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {3,0,-1}, {5,0,-1}, {7,0,-1}, {0,0,7}, {0,6,3}, {2,0,7}, {2,3,0}, {2,5,0}, {2,7,0}, {4,0,7}, {4,3,0}, {4,5,0}, {6,0,7}, {6,3,0}, {6,5,0}, {6,7,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {3,0,-1}, {5,0,-1}, {7,0,-1}, {0,0,7}, {0,6,3}, {2,0,7}, {2,3,0}, {2,5,0}, {2,7,0}, {4,0,7}, {4,3,0}, {4,5,0}, {6,0,7}, {6,3,0}, {6,5,0}, {6,7,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {3,0,-1}, {5,0,-1}, {7,0,-1}, {0,0,7}, {0,6,3}, {2,0,7}, {2,3,0}, {2,5,0}, {2,7,0}, {4,0,7}, {4,3,0}, {4,5,0}, {6,0,7}, {6,3,0}, {6,5,0}, {6,7,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {2,0,-1}, {3,0,-1}, {4,0,-1}, {5,0,-1}, {7,0,-1}, {0,0,7}, {0,6,3}, {6,0,7}, {6,3,0}, {6,5,0}, {6,7,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {2,0,-1}, {3,0,-1}, {4,0,-1}, {5,0,-1}, {0,0,7}, {0,6,3}, {6,0,7}, {6,5,0}, {7,0,6}, {7,4,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {2,0,-1}, {4,0,-1}, {5,0,-1}, {0,0,7}, {0,6,3}, {3,0,6}, {3,4,0}, {6,0,7}, {6,5,0}, {7,0,6}, {7,4,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,7,-1}, {2,0,-1}, {4,0,-1}, {5,0,-1}, {0,6,7}, {3,0,6}, {3,4,0}, {6,0,7}, {6,5,0}, {7,0,6}, {7,4,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {0,6,7}, {2,0,-1}, {4,0,-1}, {5,0,-1}, {3,0,6}, {6,5,0}, {7,0,6}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {2,0,-1}, {4,0,-1}, {5,0,-1}, {6,0,-1}, {3,0,6}, {7,0,6}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {2,0,-1}, {4,0,-1}, {5,0,-1}, {6,0,-1}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {2,0,-1}, {4,0,-1}, {5,0,-1}, {6,0,-1}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {2,0,-1}, {4,0,-1}, {5,0,-1}, {6,0,-1}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {2,0,-1}, {4,0,-1}, {5,0,-1}, {6,0,-1}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {2,0,-1}, {4,0,-1}, {5,0,-1}, {6,0,-1}, {0,5,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {2,0,-1}, {4,0,-1}, {5,0,-1}, {6,0,-1}, {0,5,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {2,0,-1}, {4,0,-1}, {5,0,-1}, {6,0,-1}, {0,5,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {2,0,-1}, {4,0,-1}, {5,0,-1}, {6,0,-1}, {0,5,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {2,0,-1}, {4,0,-1}, {6,0,-1}, {0,5,0}, {5,0,6}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {2,0,-1}, {4,0,-1}, {6,0,-1}, {5,0,6}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {2,0,-1}, {4,0,-1}, {6,0,-1}, {5,0,6}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {2,0,-1}, {4,0,-1}, {6,0,-1}, {5,0,6}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {2,0,-1}, {4,0,-1}, {6,0,-1}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {2,0,-1}, {4,0,-1}, {6,0,-1}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {2,0,-1}, {4,0,-1}, {6,0,-1}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {2,0,-1}, {4,0,-1}, {6,0,-1}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {2,0,-1}, {4,0,-1}, {6,0,-1}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {2,0,-1}, {4,0,-1}, {6,0,-1}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {2,0,-1}, {4,0,-1}, {6,0,-1}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {2,0,-1}, {4,0,-1}, {6,0,-1}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {2,0,-1}, {4,0,-1}, {6,0,-1}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {2,0,-1}, {4,0,-1}, {6,0,-1}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {2,0,-1}, {4,0,-1}, {6,0,-1}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {2,0,-1}, {4,0,-1}, {6,0,-1}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {4,0,-1}, {2,0,6}, {2,4,0}, {6,0,6}, {6,4,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}},
{{0,6,-1}, {4,0,-1}, {2,0,6}, {2,4,0}, {6,0,6}, {6,4,0}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}, {-2,-2,-2}}
};



</declaration>
	<template>
		<name x="5" y="5">Template</name>
		<declaration>
bool validate_patterns(id_pattern_t p,id_list_patterns_t  ind_patterns)
{
    if (allPatterns[ind_patterns][p][1] == -2) 
        return false;
    else
        return true;
}

int get_pattern(id_list_patterns_t ind_patterns,id_pattern_t p_id)
{
    int av=0;
    for (i:pattern_len_t)
    {
        if (allPatterns[ind_patterns][p_id][i] &gt;= 0)
            av = av + 1;
    }
    return av;
}

int applyMode(id_list_patterns_t zonotope, id_pattern_t pattern_id, int pattern_pos)  // int?
{   
    int mode_ = allPatterns[zonotope][pattern_id][pattern_pos]; 
    return mode_;
}


id_zonotope_t getZonotope()
{
    for(i: id_zonotope_t )
    {        
        if (zonotopes[i][0]&lt;=x[2] &amp;&amp; x[2] &lt; zonotopes[i][1] &amp;&amp; zonotopes[i][2]&lt;=x[1] &amp;&amp; x[1] &lt;= zonotopes[i][3]) 
        {          
            return i;
        }       
    }
    if(x[1] &lt; zonotopes[0][0])return 0;
//    return -1; 
    return 63;
}</declaration>
		<location id="id0" x="-399" y="-1547">
			<urgent/>
		</location>
		<location id="id1" x="-400" y="-1437">
			<urgent/>
		</location>
		<location id="id2" x="-68" y="-1437">
			<urgent/>
		</location>
		<location id="id3" x="-400" y="-1292">
			<urgent/>
		</location>
		<location id="id4" x="-68" y="-1292">
			<urgent/>
		</location>
		<location id="id5" x="-399" y="-1020">
			<label kind="invariant" x="-382" y="-1028">xc &lt;= step</label>
		</location>
		<location id="id6" x="-399" y="-884">
			<urgent/>
		</location>
		<location id="id7" x="-399" y="-782">
			<name x="-416" y="-757">DONE</name>
			<urgent/>
		</location>
		<location id="id8" x="-9" y="-927">
			<name x="-43" y="-876">__RESET__</name>
		</location>
		<location id="id9" x="-450" y="-1079">
			<urgent/>
		</location>
		<location id="id10" x="-348" y="-1079">
			<urgent/>
		</location>
		<branchpoint id="id11" x="-399" y="-1122">
		</branchpoint>
		<init ref="id0"/>
		<transition controllable="false">
			<source ref="id10"/>
			<target ref="id5"/>
			<label kind="assignment" x="-357" y="-1062">valve=1</label>
		</transition>
		<transition controllable="false">
			<source ref="id9"/>
			<target ref="id5"/>
			<label kind="assignment" x="-510" y="-1054">valve=0</label>
		</transition>
		<transition>
			<source ref="id11"/>
			<target ref="id10"/>
			<label kind="probability" x="-374" y="-1130">1</label>
		</transition>
		<transition>
			<source ref="id11"/>
			<target ref="id9"/>
			<label kind="probability" x="-450" y="-1122">50</label>
		</transition>
		<transition controllable="false">
			<source ref="id3"/>
			<target ref="id11"/>
			<label kind="assignment" x="-382" y="-1207">mode=applyMode(zonotope,p_id,ppos),
ppos=ppos+1</label>
		</transition>
		<transition controllable="false">
			<source ref="id8"/>
			<target ref="id8"/>
			<nail x="-60" y="-1029"/>
			<nail x="59" y="-1029"/>
		</transition>
		<transition controllable="false">
			<source ref="id6"/>
			<target ref="id7"/>
			<label kind="guard" x="-391" y="-858">yc &gt;  horizon</label>
		</transition>
		<transition controllable="false">
			<source ref="id6"/>
			<target ref="id1"/>
			<label kind="guard" x="-595" y="-1207">yc &lt;= horizon</label>
			<label kind="assignment" x="-570" y="-1173">it=it+1</label>
			<nail x="-527" y="-884"/>
			<nail x="-527" y="-1437"/>
		</transition>
		<transition controllable="false">
			<source ref="id5"/>
			<target ref="id6"/>
			<label kind="guard" x="-382" y="-1011">xc == step</label>
			<label kind="assignment" x="-382" y="-986">post(it, mode),
xc = 0,
rc = 0,
pareto = paretoFunc()</label>
		</transition>
		<transition>
			<source ref="id4"/>
			<target ref="id3"/>
			<label kind="select" x="-247" y="-1335">p : id_pattern_t</label>
			<label kind="guard" x="-298" y="-1318">validate_patterns(p,zonotope)</label>
			<label kind="assignment" x="-238" y="-1292">p_id = p,
ppos = 0,
pattern_size = get_pattern(zonotope,p),
visitedPatterns=visitedPatterns+1</label>
		</transition>
		<transition controllable="false">
			<source ref="id2"/>
			<target ref="id4"/>
			<label kind="assignment" x="-162" y="-1386">zonotope = getZonotope()</label>
		</transition>
		<transition controllable="false">
			<source ref="id1"/>
			<target ref="id3"/>
			<label kind="guard" x="-485" y="-1369">(ppos+1) &lt;= pattern_size</label>
		</transition>
		<transition controllable="false">
			<source ref="id1"/>
			<target ref="id2"/>
			<label kind="guard" x="-323" y="-1462">(ppos+1)&gt; pattern_size</label>
		</transition>
		<transition controllable="false">
			<source ref="id0"/>
			<target ref="id1"/>
			<label kind="assignment" x="-382" y="-1521">predict(),
it=1,
xc=0,
rc=0</label>
		</transition>
	</template>
	<system>// Place template instantiations here.
Process = Template();
// List one or more processes to be composed into a system.
system Process;
                    </system>
	<queries>
		<query>
			<formula></formula>
			<comment></comment>
		</query>
		<query>
			<formula></formula>
			<comment></comment>
		</query>
		<query>
			<formula></formula>
			<comment></comment>
		</query>
		<query>
			<formula></formula>
			<comment></comment>
		</query>
		<query>
			<formula>simulate 1 [&lt;=horizon] { visitedPatterns,mvalve,ppos } under Opt</formula>
			<comment></comment>
		</query>
		<query>
			<formula>simulate 1 [&lt;=horizon] { fer } under Opt</formula>
			<comment></comment>
		</query>
		<query>
			<formula>simulate 1 [&lt;=horizon] { ppos,visitedPatterns } under Opt</formula>
			<comment></comment>
		</query>
		<query>
			<formula>simulate 1 [&lt;=100] { ppos }</formula>
			<comment></comment>
		</query>
		<query>
			<formula>strategy Opt = minE (pareto) [&lt;=horizon]: &lt;&gt; GTime&gt;=horizon</formula>
			<comment></comment>
		</query>
		<query>
			<formula></formula>
			<comment></comment>
		</query>
		<query>
			<formula></formula>
			<comment></comment>
		</query>
		<query>
			<formula>simulate 1 [&lt;=horizon] { Tnext, x[2], visitedPatterns,mode  }</formula>
			<comment></comment>
		</query>
		<query>
			<formula>simulate 1 [&lt;=horizon] { mvalve, modeAns }</formula>
			<comment></comment>
		</query>
		<query>
			<formula></formula>
			<comment></comment>
		</query>
		<query>
			<formula>simulate 1 [&lt;=horizon] { ppos,visitedPatterns,mode,flag,Tnext,zi,mvalve } under Opt</formula>
			<comment></comment>
		</query>
	</queries>
</nta>
